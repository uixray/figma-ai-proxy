# 🚀 Установка в одну команду (самый простой способ)

## Что делать (3 простых шага)

### Шаг 1: Подключись к серверу

```bash
ssh -l uixray 158.160.161.94
```

Введи пароль когда попросит.

---

### Шаг 2: Скопируй и вставь ВСЮ эту команду целиком

**ВАЖНО:** Скопируй весь блок ниже (от `cat` до последней `EOF`), вставь в терминал и нажми Enter:

```bash
cat > install-proxy.sh << 'SCRIPTEOF'
#!/bin/bash
set -e
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
NC='\033[0m'

echo -e "${CYAN}🚀 Установка Figma Yandex Proxy...${NC}"

# Node.js
if ! command -v node &> /dev/null; then
    echo -e "${YELLOW}Установка Node.js...${NC}"
    curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
    sudo apt-get install -y nodejs
fi
echo -e "${GREEN}✓ Node.js: $(node --version)${NC}"

# Директория
mkdir -p ~/apps/figma-yandex-proxy
cd ~/apps/figma-yandex-proxy

# package.json
cat > package.json << 'EOF'
{
  "name": "figma-yandex-proxy",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {"start": "node server.js"},
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "helmet": "^7.1.0",
    "express-rate-limit": "^7.1.5"
  }
}
EOF

# server.js
cat > server.js << 'EOF'
const express = require('express');
const cors = require('cors');
const helmet = require('helmet');
const rateLimit = require('express-rate-limit');

const app = express();
const PORT = process.env.PORT || 3001;
const YANDEX_API = 'https://llm.api.cloud.yandex.net/foundationModels/v1/completion';

app.use(helmet());
app.use(cors({ origin: '*' }));
app.use(express.json());
app.use('/api/yandex', rateLimit({ windowMs: 60000, max: 60 }));

app.get('/health', (req, res) => {
  res.json({ status: 'ok', service: 'figma-yandex-proxy', uptime: process.uptime() });
});

app.post('/api/yandex', async (req, res) => {
  try {
    const apiKey = req.headers.authorization;
    if (!apiKey) return res.status(401).json({ error: 'No API key' });

    const response = await fetch(YANDEX_API, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Authorization': apiKey },
      body: JSON.stringify(req.body)
    });

    res.status(response.status).json(await response.json());
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

app.listen(PORT, () => console.log('✅ Proxy running on port', PORT));
EOF

# Установка
echo -e "${YELLOW}Установка зависимостей...${NC}"
npm install

# PM2
if ! command -v pm2 &> /dev/null; then
    echo -e "${YELLOW}Установка PM2...${NC}"
    sudo npm install -g pm2
fi

# Запуск
pm2 stop figma-proxy 2>/dev/null || true
pm2 delete figma-proxy 2>/dev/null || true
pm2 start server.js --name "figma-proxy"
pm2 save
sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u $USER --hp $HOME

echo ""
echo -e "${GREEN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo -e "${GREEN}✅ Готово!${NC}"
echo -e "${GREEN}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""
echo "Тест:"
sleep 2
curl -s http://localhost:3001/health | python3 -m json.tool || curl -s http://localhost:3001/health
echo ""
echo "Статус:"
pm2 status figma-proxy
echo ""
echo "Логи: pm2 logs figma-proxy"
echo "Директория: ~/apps/figma-yandex-proxy"
SCRIPTEOF

chmod +x install-proxy.sh
bash install-proxy.sh
```

**Вот и всё!** Скрипт сам всё установит и настроит.

---

### Шаг 3: Проверь что работает

После завершения установки выполни:

```bash
curl http://localhost:3001/health
```

Должен вернуть:
```json
{"status":"ok","service":"figma-yandex-proxy",...}
```

✅ **Прокси работает!**

---

## Дальше

Теперь нужно:

1. **Настроить Nginx** - чтобы прокси был доступен снаружи
2. **Обновить Figma плагин** - чтобы использовал твой прокси

Инструкции в файле `ИНСТРУКЦИЯ-ДЛЯ-НОВИЧКОВ.md` (Шаг 5 и 6).

---

## Полезные команды

```bash
# Просмотр логов
pm2 logs figma-proxy

# Перезапуск
pm2 restart figma-proxy

# Остановка
pm2 stop figma-proxy

# Статус
pm2 status
```

---

## Если что-то пошло не так

Пришли мне вывод этих команд:

```bash
node --version
npm --version
pm2 logs figma-proxy --lines 20
```

Помогу разобраться! 😊
