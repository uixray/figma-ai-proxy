# Обновление прокси на сервере

## Первый раз (свежая установка с GitHub)

Если прокси ещё не установлен на сервере:

```bash
ssh user@твой-сервер
```

```bash
cd ~/apps
git clone https://github.com/uixray/figma-ai-proxy.git
cd figma-ai-proxy
npm install
pm2 start server.js --name "figma-ai-proxy" --time
pm2 save
```

---

## Обновление (когда код уже стоит на сервере)

### Вариант А — одна команда (рекомендуется)

Скопируй и вставь в терминал:

```bash
cd ~/apps/figma-ai-proxy && git pull && npm install && pm2 restart figma-ai-proxy && echo "✅ Готово!" && curl -s http://localhost:3001/health
```

Должен вернуть:
```json
{"status":"ok","service":"figma-ai-proxy","version":"2.0.0","providers":["yandex","claude","gemini","groq","mistral","cohere"]}
```

---

### Вариант Б — по шагам

**Шаг 1. Подключись к серверу**
```bash
ssh user@твой-сервер
```

**Шаг 2. Перейди в папку с прокси**
```bash
cd ~/apps/figma-ai-proxy
```

**Шаг 3. Скачай обновления**
```bash
git pull
```

**Шаг 4. Обнови зависимости (если изменился package.json)**
```bash
npm install
```

**Шаг 5. Перезапусти сервер**
```bash
pm2 restart figma-ai-proxy
```

**Шаг 6. Проверь что всё работает**
```bash
curl http://localhost:3001/health
pm2 logs figma-ai-proxy --lines 20
```

---

## Если старый прокси работал под именем figma-proxy

При первом обновлении с v1.0.0 → v2.0.0 нужно переключить PM2 процесс:

```bash
cd ~/apps/figma-ai-proxy
git pull
npm install
pm2 stop figma-proxy 2>/dev/null || true
pm2 delete figma-proxy 2>/dev/null || true
pm2 start server.js --name "figma-ai-proxy" --time
pm2 save
```

---

## Если папка называется figma-yandex-proxy

Старое имя папки не мешает — просто используй его:

```bash
cd ~/apps/figma-yandex-proxy   # старое имя папки — ок
git pull
npm install
pm2 restart figma-ai-proxy     # или figma-proxy если не переименовывал
```

---

## Полезные команды

```bash
# Статус процесса
pm2 status

# Логи в реальном времени
pm2 logs figma-ai-proxy

# Перезапуск
pm2 restart figma-ai-proxy

# Текущая версия прокси
curl -s http://localhost:3001/health | python3 -m json.tool

# Список провайдеров
curl -s http://localhost:3001/api/info | python3 -m json.tool
```

---

## Если git pull говорит "Already up to date"

Значит на сервере уже стоит последняя версия. Но можно принудительно перезапустить:

```bash
pm2 restart figma-ai-proxy
```

---

## Репозиторий

https://github.com/uixray/figma-ai-proxy
